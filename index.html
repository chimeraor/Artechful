<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Artechful</title>
    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --tech-bg: #0a0a0a;
            --tech-accent: #00ff41; 
            --tech-secondary: #1f2937;
            --tech-alert: #ff0033;
            --tech-font: 'Courier New', monospace;

            --art-bg: #f3e5ab; 
            --art-accent: #8a3324; 
            --art-secondary: #ffd700;
            --art-font: 'Brush Script MT', cursive;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: sans-serif;
            transition: background-color 0.5s ease;
        }

        #game-container { position: relative; width: 100vw; height: 100vh; }

        /* --- WELCOME SCREEN --- */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505;
            z-index: 2000;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: opacity 1.5s ease-in-out;
            padding: 20px;
            text-align: center;
        }
        
        #welcome-screen.hidden { opacity: 0; pointer-events: none; }

        .welcome-title {
            font-size: clamp(3rem, 10vw, 6rem); /* Responsive Font Size */
            font-family: var(--tech-font);
            color: transparent;
            -webkit-text-stroke: 2px var(--tech-accent);
            position: relative;
            letter-spacing: clamp(5px, 1vw, 10px);
            margin-bottom: 50px;
            animation: glitch-main 3s infinite;
            max-width: 100%;
            word-wrap: break-word;
        }

        .welcome-title::before {
            content: "ARTECHFUL";
            position: absolute; left: 5px; top: 5px;
            color: var(--art-accent);
            font-family: var(--art-font);
            -webkit-text-stroke: 0;
            opacity: 0.6;
            filter: blur(1px);
            mix-blend-mode: screen;
            animation: float-art 4s infinite ease-in-out;
            pointer-events: none;
        }

        .start-btn {
            padding: 15px 50px;
            background: transparent;
            border: 1px solid var(--tech-accent);
            color: var(--tech-accent);
            font-family: var(--tech-font);
            font-size: clamp(1rem, 4vw, 1.5rem);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 5px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .start-btn:hover {
            background: var(--tech-accent);
            color: #000;
            box-shadow: 0 0 30px var(--tech-accent);
        }

        /* --- LAYERS --- */
        .layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; pointer-events: none; transition: opacity 0.5s ease; z-index: 1;
        }
        .layer.active { opacity: 1; pointer-events: all; z-index: 2; }

        /* Tech Look */
        #tech-layer {
            background-color: var(--tech-bg); color: var(--tech-accent);
            font-family: var(--tech-font);
            background-image: 
                linear-gradient(rgba(0, 255, 65, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 65, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Art Look */
        #art-layer {
            background-color: var(--art-bg); color: var(--art-accent);
            font-family: var(--art-font);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.15'/%3E%3C/svg%3E");
        }

        /* Art Decorations */
        .art-blob {
            position: absolute; opacity: 0.6; filter: blur(20px); z-index: -1;
            animation: float-art 10s infinite ease-in-out;
        }
        .blob-1 { top: 10%; left: 10%; width: 200px; height: 200px; background: #ff00cc; border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
        .blob-2 { bottom: 20%; right: 10%; width: 300px; height: 300px; background: #00ccff; border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; animation-delay: 2s; }
        .blob-3 { top: 40%; left: 60%; width: 150px; height: 150px; background: #ffd700; border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; animation-delay: 4s; }

        /* --- OBJECT LAYOUT --- */
        .object-container {
            position: absolute; cursor: pointer; transition: transform 0.2s;
            left: 50%; transform: translateX(-50%);
        }
        .object-container:hover { transform: translateX(-50%) scale(1.05); }

        /* Responsive Positioning & Sizing */
        .pos-door { 
            top: 5vh; 
            width: 30vw; max-width: 140px; min-width: 100px;
            height: auto; aspect-ratio: 2/3;
        }
        .pos-workstation { 
            top: 50vh; 
            width: 80vw; max-width: 300px; 
            height: auto; aspect-ratio: 3/2;
        }
        
        /* Books */
        .pos-book-left { 
            top: 75vh; left: 15%; 
            width: 15vw; max-width: 90px; 
            height: auto; aspect-ratio: 3/4; 
            transform: rotate(-8deg); 
        }
        .pos-book-right { 
            top: 75vh; left: 85%; 
            width: 18vw; max-width: 110px; 
            height: auto; aspect-ratio: 3/4;
            transform: rotate(12deg); 
        }

        /* --- OBJECT STYLES --- */
        .server-rack {
            width: 100%; height: 100%; border: 2px solid var(--tech-accent);
            background: rgba(0, 20, 0, 0.9); box-shadow: 0 0 15px var(--tech-accent);
            display: flex; flex-direction: column; padding: 10px;
        }
        .server-screen {
            flex-grow: 1; border-bottom: 1px solid var(--tech-accent);
            margin-bottom: 10px; font-size: clamp(8px, 2vw, 10px); padding: 5px; color: var(--tech-accent); overflow: hidden;
        }
        
        .easel { width: 100%; height: 100%; position: relative; }
        .canvas-frame {
            width: 90%; height: 80%; background: #fff;
            border: 8px solid #8b4513; position: absolute; top: 0; left: 5%;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
            display: flex; justify-content: center; align-items: center; 
            flex-direction: column;
        }
        
        .thought-display {
            padding: 10px; text-align: center; 
            font-size: clamp(1rem, 4vw, 1.4rem); 
            color: #5d4037;
            font-style: italic; opacity: 0; transition: opacity 1s;
        }
        .thought-display.visible { opacity: 1; }

        .tech-manual, .art-journal {
            width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;
        }
        .tech-manual { background: #111; border: 1px solid var(--tech-accent); color: var(--tech-accent); font-size: clamp(0.6rem, 2vw, 0.8rem); }
        .art-journal { background: #8d6e63; border-left: 5px solid #3e2723; color: #fff; border-radius: 0 5px 5px 0; font-size: clamp(0.6rem, 2vw, 0.8rem);}

        .blast-door, .vine-door { 
            width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; 
            overflow: hidden; position: relative;
        }
        .blast-door { background: #333; border: 4px solid #555; }
        .vine-door { background: #5d4037; border: 4px solid #3e2723; }
        
        .door-status { width: 20px; height: 20px; background: var(--tech-alert); border-radius: 50%; box-shadow: 0 0 10px var(--tech-alert); z-index: 2; }
        
        .door-light {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #fff, gold, var(--tech-accent));
            opacity: 0; transition: opacity 1.5s ease-in; z-index: 1;
        }
        .blast-door.open .door-status { display: none; }
        .blast-door.open .door-light { opacity: 1; }

        /* --- UI & MODALS --- */
        #hud {
            position: absolute; bottom: 5vh; width: 100%;
            display: flex; justify-content: center; z-index: 300;
        }
        #lens-toggle {
            padding: 12px 30px; font-size: 1.1rem; cursor: pointer; border-radius: 25px;
            font-weight: bold; transition: all 0.3s;
            /* Prevent zoom on tap */
            touch-action: manipulation;
        }
        .mode-tech #lens-toggle { background: var(--tech-secondary); color: var(--tech-accent); border: 2px solid var(--tech-accent); }
        .mode-art #lens-toggle { background: var(--art-accent); color: var(--art-bg); border: 4px solid var(--art-secondary); }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 400; display: none;
            justify-content: center; align-items: center; flex-direction: column;
            padding: 10px;
        }
        .modal-overlay.visible { display: flex; }

        /* Terminal Specifics - Responsive */
        .terminal-box {
            width: 95vw; max-width: 600px;
            padding: 20px; background: #000;
            border: 2px solid var(--tech-accent); color: var(--tech-accent);
            font-family: var(--tech-font);
        }
        .term-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .lang-btn {
            background: #111; color: var(--tech-accent); border: 1px solid var(--tech-accent);
            padding: 8px 16px; cursor: pointer; font-family: var(--tech-font);
            position: relative; transition: all 0.2s;
            display: flex; align-items: center; gap: 10px;
            font-size: 0.9rem;
        }
        .lang-btn:hover { background: rgba(0, 255, 65, 0.1); box-shadow: 0 0 10px var(--tech-accent); }
        .lang-btn.locked { display: none; } 

        #term-screen {
            border: 1px solid #333; height: 60px; margin-bottom: 10px;
            padding: 10px; font-size: clamp(1.2rem, 5vw, 2rem); 
            display: flex; align-items: center; letter-spacing: 5px;
            background: rgba(0, 20, 0, 0.5);
            overflow-x: auto; white-space: nowrap; /* Handle long text */
        }
        #term-feedback { height: 20px; color: var(--tech-alert); font-size: 0.8rem; margin-bottom: 15px; font-weight: bold; }
        
        #keyboard-container { transition: all 0.2s cubic-bezier(0.4, 0.0, 0.2, 1); }
        #keyboard-container.reconfiguring { opacity: 0.5; filter: blur(4px); transform: scale(0.98); }
        
        .keyboard-row { display: flex; justify-content: center; gap: clamp(2px, 1vw, 5px); margin-bottom: 5px; }
        .key {
            width: clamp(28px, 8vw, 50px); height: clamp(35px, 8vw, 50px);
            border: 1px solid var(--tech-accent);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-weight: bold; transition: all 0.1s;
            font-size: clamp(0.8rem, 2.5vw, 1.2rem);
        }
        .key:hover { background: var(--tech-accent); color: #000; }
        
        .key.broken {
            border: 1px dashed #333; color: #333; cursor: not-allowed;
            background: repeating-linear-gradient(45deg, #000, #000 5px, #111 5px, #111 10px);
        }
        .key.broken:hover { background: repeating-linear-gradient(45deg, #000, #000 5px, #111 5px, #111 10px); color: #333; }

        .lore-box { width: 95vw; max-width: 500px; padding: 30px; font-size: clamp(0.9rem, 3vw, 1.1rem); line-height: 1.6; }
        .lore-tech { background: #001100; border: 2px solid var(--tech-accent); color: var(--tech-accent); font-family: var(--tech-font); }
        .lore-art { background: #fff9e6; border: 8px solid #8d6e63; color: #3e2723; font-family: 'Times New Roman', serif; }
        
        .close-btn { margin-top: 20px; background: none; border: 1px solid currentColor; color: currentColor; padding: 5px 15px; cursor: pointer; }

        /* Animations */
        .glitch-anim { animation: glitch-skew 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite; }
        @keyframes glitch-skew {
            0% { transform: translate(0) }
            20% { transform: translate(-5px, 5px) } 40% { transform: translate(-5px, -5px) }
            60% { transform: translate(5px, 5px) } 80% { transform: translate(5px, -5px) }
            100% { transform: translate(0) }
        }
        @keyframes glitch-main {
            0% { transform: skew(0deg); }
            5% { transform: skew(-2deg); }
            10% { transform: skew(2deg); }
            15% { transform: skew(0deg); }
            100% { transform: skew(0deg); }
        }
        @keyframes float-art {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(10px, -10px) rotate(5deg); }
        }

        /* --- FINAL SCENE STYLES --- */
        #end-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%);
            z-index: 500; display: none;
            justify-content: center; align-items: center; flex-direction: column;
            opacity: 0; transition: opacity 3s;
            color: white; font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }
        
        .syzygy-container {
            display: flex; align-items: center; justify-content: center; gap: 0;
            margin-bottom: 40px;
        }
        
        .celestial-body {
            border-radius: 50%; position: relative; opacity: 0;
            transform: scale(0); transition: all 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .c-sun { width: 100px; height: 100px; background: radial-gradient(circle at 30% 30%, #ffd700, #8a3324); box-shadow: 0 0 30px #ffd700; z-index: 1; }
        .c-earth {
            width: 60px; height: 60px; background: #000; border: 2px solid var(--tech-accent);
            box-shadow: 0 0 15px var(--tech-accent);
            background-image: linear-gradient(var(--tech-accent) 1px, transparent 1px), linear-gradient(90deg, var(--tech-accent) 1px, transparent 1px);
            background-size: 10px 10px; z-index: 2; margin: 0 20px;
        }
        .c-moon { width: 62px; height: 62px; background: #000; border: 1px solid #333; z-index: 3; box-shadow: inset 0 0 10px #fff; }

        .syzygy-container.aligned .celestial-body { opacity: 1; transform: scale(1); margin: 0 -15px; }

        .final-title {
            font-size: clamp(3rem, 10vw, 5rem); letter-spacing: 1rem; margin: 0;
            background: -webkit-linear-gradient(#00ff41, #ffd700);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            opacity: 0; transform: translateY(20px); transition: all 2s;
        }
        
        .final-quote {
            margin-top: 20px; font-size: clamp(1rem, 3vw, 1.2rem); color: #aaa; font-style: italic;
            opacity: 0; transition: opacity 2s 1s; max-width: 600px; line-height: 1.6;
        }

        .phil-btn {
            margin-top: 40px; background: transparent; border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.7); padding: 10px 20px; cursor: pointer;
            font-size: 1rem; letter-spacing: 2px; text-transform: uppercase;
            opacity: 0; transition: all 1s ease;
        }
        .phil-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.1); }

        /* Updated Philosophy Modal - Full Screen Overlay */
        .phil-text {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000; /* Topmost layer */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 1s;
        }

        .phil-content-inner {
            max-width: 800px;
            font-size: clamp(1rem, 3vw, 1.3rem);
            line-height: 1.8;
            color: #eee;
            text-align: left;
            border-left: 4px solid #ffd700;
            padding-left: 20px;
            max-height: 70vh; /* Allow scrolling if content is too tall */
            overflow-y: auto;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .visible { opacity: 1 !important; transform: translateY(0) !important; }

        /* MOBILE OVERRIDES for very small screens */
        @media (max-height: 600px) {
            .pos-workstation { top: 40vh; height: 40vh; }
            .pos-door { top: 2vh; height: 30vh; }
            .pos-book-left { top: 80vh; }
            .pos-book-right { top: 80vh; }
            #hud { bottom: 10px; }
        }

    </style>
</head>
<body class="mode-tech">

    <!-- WELCOME SCREEN -->
    <div id="welcome-screen">
        <h1 class="welcome-title">ARTECHFUL</h1>
        <button class="start-btn" onclick="startGame()">INITIALIZE</button>
    </div>

    <div id="game-container">
        <!-- TECH LAYER -->
        <div id="tech-layer" class="layer active">
            <div class="object-container pos-workstation" onclick="openTerminal()">
                <div class="server-rack">
                    <div class="server-screen">
                        > SYSTEM ERROR<br>
                        > KEYBOARD DRIVER FAILURE (ZONE: BOTTOM-LEFT)<br>
                        > AUTH_CODE REQUIRED: [SEE SYS_LOG]
                    </div>
                </div>
            </div>
            <div class="object-container pos-book-right" onclick="showLore('TECH')">
                <div class="tech-manual">SYS_LOG</div>
            </div>
            <div id="tech-door" class="object-container pos-door">
                <div class="blast-door">
                    <div class="door-status"></div>
                    <div class="door-light"></div>
                </div>
            </div>
        </div>

        <!-- ART LAYER -->
        <div id="art-layer" class="layer">
            <div class="art-blob blob-1"></div>
            <div class="art-blob blob-2"></div>
            <div class="art-blob blob-3"></div>

            <div class="object-container pos-workstation">
                <div class="easel">
                    <div class="canvas-frame" onclick="cycleThought()">
                        <div id="art-text" class="thought-display"></div>
                    </div>
                </div>
            </div>
            <div class="object-container pos-book-left" onclick="showLore('ART')">
                <div class="art-journal">Journal</div>
            </div>
            <div id="art-door" class="object-container pos-door">
                <div class="vine-door">ðŸŒ¿</div>
            </div>
        </div>

        <!-- HUD -->
        <div id="hud">
            <button id="lens-toggle" onclick="toggleLens()">SWITCH LENS</button>
        </div>

        <!-- LORE MODAL -->
        <div id="lore-modal" class="modal-overlay">
            <div id="lore-content" class="lore-box">
                <h2 id="lore-title"></h2>
                <p id="lore-text"></p>
                <button class="close-btn" onclick="closeLore()">CLOSE</button>
            </div>
        </div>

        <!-- TERMINAL MODAL -->
        <div id="terminal-modal" class="modal-overlay">
            <div class="terminal-box">
                <div class="term-header">
                    <span>SECURE TERMINAL // <span style="opacity:0.6">INPUT_MAP</span></span>
                    <button id="lang-btn" class="lang-btn" onclick="toggleLanguage()">
                        <span id="lang-indicator">DRIVER: EN (US)</span>
                    </button>
                </div>
                
                <div id="term-screen"></div>
                <div id="term-feedback"></div>
                
                <div id="keyboard-container"></div>
                
                <div style="font-size: 0.8rem; color: #555; margin-top: 10px;">
                    DEBUG: KEY_SCAN_CODE_44 (BOTTOM-LEFT) IS UNRESPONSIVE.
                </div>
                
                <button class="close-btn" onclick="closeTerminal()">CLOSE TERMINAL</button>
            </div>
        </div>

        <!-- FINAL SCENE -->
        <div id="end-screen">
            <div class="syzygy-container" id="syzygy-anim">
                <div class="celestial-body c-sun"></div>
                <div class="celestial-body c-earth"></div>
                <div class="celestial-body c-moon"></div>
            </div>
            <h1 id="end-title" class="final-title">SYZYGY</h1>
            <p id="end-quote" class="final-quote">
                "To reach the End (Z), I had to ask Why (Y).<br>
                And in the union of opposites, I found my beginning."
            </p>
            
            <button id="phil-btn" class="phil-btn" onclick="revealPhilosophy()">Read Reflection</button>
            
            <!-- Philosophy Overlay -->
            <div id="phil-text" class="phil-text">
                <div class="phil-content-inner">
                    <strong>THE ARCHITECTURE OF DUALITY</strong><br><br>
                    We live in a world that demands we choose: Engineer or Artist? QWERTY or QWERTZ? Logic or Feeling?<br><br>
                    But the mechanical truth of the keyboard reveals a deeper lesson. The 'Y' (the Question) and the 'Z' (the End) are interchangeable. They are not opposites, but counterparts.<br><br>
                    To solve the puzzle of identity, one cannot simply 'fix' the glitch. One must embrace the shift. True purpose is found not in choosing one side, but in the <em>Syzygy</em>â€”the dynamic tension where both worlds orbit a single center.
                </div>
                <button class="close-btn" onclick="closePhilosophy()" style="margin-top:30px; border: 1px solid #555;">RETURN</button>
            </div>
        </div>
    </div>

    <script>
        const gameState = { 
            currentLens: 'TECH', 
            doorOpen: false, 
            currentInput: "",
            thoughtIndex: -1,
            currentLang: 'EN'
        };
        
        const PASSWORD = "SYZYGY";
        const THOUGHTS = [
            "This room is split... just like my mind.",
            "Technology loves structure. Art loves chaos.",
            "But the German language... it found a way to bridge them.",
            "It swapped the End (Z) and the Question (Y).",
            "If I speak the language, maybe the broken keys won't matter."
        ];

        // Elements
        const body = document.body;
        const gameContainer = document.getElementById('game-container');
        const welcomeScreen = document.getElementById('welcome-screen');
        const techLayer = document.getElementById('tech-layer');
        const artLayer = document.getElementById('art-layer');
        const toggleBtn = document.getElementById('lens-toggle');
        const artText = document.getElementById('art-text');
        
        // Modals
        const loreModal = document.getElementById('lore-modal');
        const loreContent = document.getElementById('lore-content');
        const loreTitle = document.getElementById('lore-title');
        const loreText = document.getElementById('lore-text');
        const terminalModal = document.getElementById('terminal-modal');
        const termScreen = document.getElementById('term-screen');
        const termFeedback = document.getElementById('term-feedback');
        const keyboardContainer = document.getElementById('keyboard-container');
        const langBtn = document.getElementById('lang-btn');
        const langIndicator = document.getElementById('lang-indicator');
        const endScreen = document.getElementById('end-screen');
        const philBtn = document.getElementById('phil-btn');
        const philText = document.getElementById('phil-text');

        // --- INIT ---
        function startGame() {
            welcomeScreen.classList.add('hidden');
        }

        // --- CORE GAMEPLAY ---
        function toggleLens() {
            if (gameState.doorOpen) return;
            gameContainer.classList.add('glitch-anim');
            setTimeout(() => {
                if (gameState.currentLens === 'TECH') {
                    gameState.currentLens = 'ART';
                    body.classList.remove('mode-tech'); body.classList.add('mode-art');
                    techLayer.classList.remove('active'); artLayer.classList.add('active');
                    toggleBtn.innerText = "Switch to Logic";
                    
                    if (gameState.thoughtIndex === -1) {
                        artText.innerText = "Click to think...";
                        artText.classList.add('visible');
                    }
                } else {
                    gameState.currentLens = 'TECH';
                    body.classList.remove('mode-art'); body.classList.add('mode-tech');
                    artLayer.classList.remove('active'); techLayer.classList.add('active');
                    toggleBtn.innerText = "Switch to Abstract";
                }
                setTimeout(() => gameContainer.classList.remove('glitch-anim'), 300);
            }, 100);
        }

        // --- ART SIDE ---
        function cycleThought() {
            // Loop back to start if at end
            gameState.thoughtIndex = (gameState.thoughtIndex + 1) % THOUGHTS.length;
            
            artText.style.opacity = 0;
            setTimeout(() => {
                artText.innerText = THOUGHTS[gameState.thoughtIndex];
                artText.style.opacity = 1;
            }, 500);
        }

        function showLore(type) {
            loreModal.classList.add('visible');
            if (type === 'TECH') {
                loreContent.className = 'lore-box lore-tech';
                loreTitle.innerText = "SYS_LOG_ERROR.txt";
                loreText.innerHTML = `
                    CRITICAL FAILURE: INPUT DEVICE.<br>
                    Physical key at [ROW:3, COL:1] (Bottom-Left) is unresponsive.<br>
                    In current English Layout, this renders the letter 'Z' inaccessible.<br><br>
                    <strong>AUTH PROTOCOL:</strong> System requires the scientific term for when three celestial bodies align in a straight line.
                `;
            } else {
                loreContent.className = 'lore-box lore-art';
                loreTitle.innerText = "The Astronomer's Riddle";
                loreText.innerHTML = `
                    I seek the word for the perfect line.<br>
                    Sun, Earth, Moon.<br><br>
                    A <strong>S</strong>erpent coils at the start.<br>
                    Three times, the Question (<strong>Y</strong>) is asked.<br>
                    The End of All Things (<strong>Z</strong>) lies at the heart.<br>
                    And <strong>G</strong>ravity binds the final stars.<br><br>
                `;
            }
        }

        function closeLore() { loreModal.classList.remove('visible'); }

        // --- TECH SIDE ---
        function openTerminal() {
            if (gameState.doorOpen) return;
            terminalModal.classList.add('visible');
            updateLangButton();
            renderTerminal(false);
        }

        function closeTerminal() { terminalModal.classList.remove('visible'); }

        function toggleLanguage() {
            keyboardContainer.classList.add('reconfiguring');
            termFeedback.innerText = `> UNLOADING DRIVER: ${gameState.currentLang}...`;
            termFeedback.style.color = "#ffff00";

            setTimeout(() => {
                gameState.currentLang = (gameState.currentLang === 'EN') ? 'DE' : 'EN';
                updateLangButton();
                renderTerminal(true);
                keyboardContainer.classList.remove('reconfiguring');
                termFeedback.innerText = `> DRIVER LOADED: ${gameState.currentLang}`;
                termFeedback.style.color = "var(--tech-accent)";
            }, 300);
        }

        function updateLangButton() {
            if (gameState.currentLang === 'EN') {
                langIndicator.innerText = "DRIVER: EN (US)";
            } else {
                langIndicator.innerText = "DRIVER: DE (ISO)";
            }
        }

        function renderTerminal(animateChanges) {
            termScreen.innerText = gameState.currentInput + "_";
            
            let rows;
            if (gameState.currentLang === 'EN') {
                rows = ["QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM"];
            } else {
                rows = ["QWERTZUIOP", "ASDFGHJKL", "YXCVBNM"];
            }

            keyboardContainer.innerHTML = '';

            rows.forEach((rowStr, rowIndex) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                
                for (let i = 0; i < rowStr.length; i++) {
                    const char = rowStr[i];
                    const keyDiv = document.createElement('div');
                    const isBrokenKey = (rowIndex === 2 && i === 0);
                    
                    if (isBrokenKey) {
                        keyDiv.className = 'key broken';
                        keyDiv.innerText = char; 
                        keyDiv.onclick = () => {
                            termFeedback.innerText = `ERROR: KEY '${char}' UNRESPONSIVE.`;
                            termFeedback.style.color = "var(--tech-alert)";
                        };
                    } else {
                        keyDiv.className = 'key';
                        keyDiv.innerText = char;
                        keyDiv.onclick = () => typeChar(char);
                    }
                    rowDiv.appendChild(keyDiv);
                }
                keyboardContainer.appendChild(rowDiv);
            });
            
            const actionRow = document.createElement('div');
            actionRow.className = 'keyboard-row';
            actionRow.innerHTML = `<div class="key" style="width:80px" onclick="typeChar('BACK')">DEL</div><div class="key" style="width:80px" onclick="submitPass()">ENTER</div>`;
            keyboardContainer.appendChild(actionRow);
        }

        function typeChar(char) {
            if (char === 'BACK') {
                gameState.currentInput = gameState.currentInput.slice(0, -1);
            } else if (gameState.currentInput.length < 10) {
                gameState.currentInput += char;
            }
            termScreen.innerText = gameState.currentInput + "_";
            termFeedback.innerText = ""; 
        }

        function submitPass() {
            if (gameState.currentInput === PASSWORD) {
                winGame();
            } else {
                if (gameState.currentInput.length !== 6) {
                    termFeedback.innerText = "ERROR: INVALID LENGTH";
                } else {
                    termFeedback.innerText = "ERROR: INCORRECT PASSCODE";
                }
                termFeedback.style.color = "var(--tech-alert)";
            }
        }

        function winGame() {
            closeTerminal();
            gameState.doorOpen = true;
            document.querySelector('.blast-door').classList.add('open');
            
            setTimeout(() => {
                endScreen.style.display = 'flex';
                setTimeout(() => {
                    endScreen.style.opacity = 1;
                    setTimeout(() => {
                        document.getElementById('syzygy-anim').classList.add('aligned');
                        document.getElementById('end-title').classList.add('visible');
                        document.getElementById('end-quote').classList.add('visible');
                        setTimeout(() => { philBtn.classList.add('visible'); }, 2000);
                    }, 1000);
                }, 100);
            }, 1500);
        }

        function revealPhilosophy() {
            philBtn.style.display = 'none';
            // Use Flex to center vertically and horizontally
            philText.style.display = 'flex'; 
        }

        function closePhilosophy() {
            philText.style.display = 'none';
            philBtn.style.display = 'block';
        }
    </script>
</body>
</html>
